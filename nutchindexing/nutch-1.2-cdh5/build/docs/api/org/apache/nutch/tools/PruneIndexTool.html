<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_55) on Wed May 07 10:09:59 CST 2014 -->
<title>PruneIndexTool (Nutch 1.2 API)</title>
<meta name="date" content="2014-05-07">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="PruneIndexTool (Nutch 1.2 API)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/PruneIndexTool.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../org/apache/nutch/tools/FreeGenerator.FG.html" title="class in org.apache.nutch.tools"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../org/apache/nutch/tools/PruneIndexTool.PrintFieldsChecker.html" title="class in org.apache.nutch.tools"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/apache/nutch/tools/PruneIndexTool.html" target="_top">Frames</a></li>
<li><a href="PruneIndexTool.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested_class_summary">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.apache.nutch.tools</div>
<h2 title="Class PruneIndexTool" class="title">Class PruneIndexTool</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>org.apache.nutch.tools.PruneIndexTool</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd>java.lang.Runnable</dd>
</dl>
<hr>
<br>
<pre>public class <span class="strong">PruneIndexTool</span>
extends java.lang.Object
implements java.lang.Runnable</pre>
<div class="block">This tool prunes existing Nutch indexes of unwanted content. The main method
 accepts a list of segment directories (containing indexes). These indexes will
 be pruned of any content that matches one or more query from a list of Lucene
 queries read from a file (defined in standard config file, or explicitly
 overridden from command-line). Segments should already be indexed, if some
 of them are missing indexes then these segments will be skipped.
 
 <p>NOTE 1: Queries are expressed in Lucene's QueryParser syntax, so a knowledge
 of available Lucene document fields is required. This can be obtained by reading sources
 of <code>index-basic</code> and <code>index-more</code> plugins, or using tools
 like <a href="http://www.getopt.org/luke">Luke</a>. During query parsing a
 WhitespaceAnalyzer is used - this choice has been made to minimize side effects of
 Analyzer on the final set of query terms. You can use <a href="../../../../org/apache/nutch/searcher/Query.html#main(java.lang.String[])"><code>Query.main(String[])</code></a>
 method to translate queries in Nutch syntax to queries in Lucene syntax.<br>
 If additional level of control is required, an instance of <a href="../../../../org/apache/nutch/tools/PruneIndexTool.PruneChecker.html" title="interface in org.apache.nutch.tools"><code>PruneIndexTool.PruneChecker</code></a> can
 be provided to check each document before it's deleted. The results of all
 checkers are logically AND-ed, which means that any checker in the chain
 can veto the deletion of the current document. Two example checker implementations
 are provided - PrintFieldsChecker prints the values of selected index fields,
 StoreUrlsChecker stores the URLs of deleted documents to a file. Any of them can
 be activated by providing respective command-line options.
 </p>
 <p>The typical command-line usage is as follows:<br>
 <blockquote>
 <code>PruneIndexTool index_dir -dryrun -queries queries.txt -showfields url,title</code><br>
 This command will just print out fields of matching documents.<br>
 <code>PruneIndexTool index_dir -queries queries.txt</code><br>
 This command will actually remove all matching entries, according to the
 queries read from <code>queries.txt</code> file.
 </blockquote></p>
 <p>NOTE 2: This tool removes matching documents ONLY from segment indexes (or
 from a merged index). In particular it does NOT remove the pages and links
 from WebDB. This means that unwanted URLs may pop up again when new segments
 are created. To prevent this, use your own <a href="../../../../org/apache/nutch/net/URLFilter.html" title="interface in org.apache.nutch.net"><code>URLFilter</code></a>,
 or PruneDBTool (under construction...).</p>
 <p>NOTE 3: This tool uses a low-level Lucene interface to collect all matching
 documents. For large indexes and broad queries this may result in high memory
 consumption. If you encounter OutOfMemory exceptions, try to narrow down your
 queries, or increase the heap size.</p></div>
<dl><dt><span class="strong">Author:</span></dt>
  <dd>Andrzej Bialecki &lt;ab@getopt.org&gt;</dd></dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="nested_class_summary">
<!--   -->
</a>
<h3>Nested Class Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Nested Class Summary table, listing nested classes, and an explanation">
<caption><span>Nested Classes</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Class and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/nutch/tools/PruneIndexTool.PrintFieldsChecker.html" title="class in org.apache.nutch.tools">PruneIndexTool.PrintFieldsChecker</a></strong></code>
<div class="block">This checker's main function is just to print out
 selected field values from each document, just before
 they are deleted.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static interface&nbsp;</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/nutch/tools/PruneIndexTool.PruneChecker.html" title="interface in org.apache.nutch.tools">PruneIndexTool.PruneChecker</a></strong></code>
<div class="block">This interface can be used to implement additional checking on matching
 documents.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/nutch/tools/PruneIndexTool.StoreUrlsChecker.html" title="class in org.apache.nutch.tools">PruneIndexTool.StoreUrlsChecker</a></strong></code>
<div class="block">This checker's main function is just to store
 the URLs of each document to be deleted in a text file.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static org.apache.commons.logging.Log</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/nutch/tools/PruneIndexTool.html#LOG">LOG</a></strong></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static int</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/nutch/tools/PruneIndexTool.html#LOG_STEP">LOG_STEP</a></strong></code>
<div class="block">Log the progress every LOG_STEP number of processed documents.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../../org/apache/nutch/tools/PruneIndexTool.html#PruneIndexTool(java.io.File[], org.apache.lucene.search.Query[], org.apache.nutch.tools.PruneIndexTool.PruneChecker[], boolean, boolean)">PruneIndexTool</a></strong>(java.io.File[]&nbsp;indexDirs,
              org.apache.lucene.search.Query[]&nbsp;queries,
              <a href="../../../../org/apache/nutch/tools/PruneIndexTool.PruneChecker.html" title="interface in org.apache.nutch.tools">PruneIndexTool.PruneChecker</a>[]&nbsp;checkers,
              boolean&nbsp;unlock,
              boolean&nbsp;dryrun)</code>
<div class="block">Create an instance of the tool, and open all input indexes.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/nutch/tools/PruneIndexTool.html#main(java.lang.String[])">main</a></strong>(java.lang.String[]&nbsp;args)</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static org.apache.lucene.search.Query[]</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/nutch/tools/PruneIndexTool.html#parseQueries(java.io.InputStream)">parseQueries</a></strong>(java.io.InputStream&nbsp;is)</code>
<div class="block">Read a list of Lucene queries from the stream (UTF-8 encoding is assumed).</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/nutch/tools/PruneIndexTool.html#run()">run</a></strong>()</code>
<div class="block">For each query, find all matching documents and delete them from all input
 indexes.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="LOG">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>LOG</h4>
<pre>public static final&nbsp;org.apache.commons.logging.Log LOG</pre>
</li>
</ul>
<a name="LOG_STEP">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>LOG_STEP</h4>
<pre>public static&nbsp;int LOG_STEP</pre>
<div class="block">Log the progress every LOG_STEP number of processed documents.</div>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="PruneIndexTool(java.io.File[], org.apache.lucene.search.Query[], org.apache.nutch.tools.PruneIndexTool.PruneChecker[], boolean, boolean)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>PruneIndexTool</h4>
<pre>public&nbsp;PruneIndexTool(java.io.File[]&nbsp;indexDirs,
              org.apache.lucene.search.Query[]&nbsp;queries,
              <a href="../../../../org/apache/nutch/tools/PruneIndexTool.PruneChecker.html" title="interface in org.apache.nutch.tools">PruneIndexTool.PruneChecker</a>[]&nbsp;checkers,
              boolean&nbsp;unlock,
              boolean&nbsp;dryrun)
               throws java.lang.Exception</pre>
<div class="block">Create an instance of the tool, and open all input indexes.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>indexDirs</code> - directories with input indexes. At least one valid index must
 exist, otherwise an Exception is thrown.</dd><dd><code>queries</code> - pruning queries. Each query will be processed in turn, and the
 length of the array must be at least one, otherwise an Exception is thrown.</dd><dd><code>checkers</code> - if not null, they will be used to perform additional
 checks on matching documents - each checker's method <a href="../../../../org/apache/nutch/tools/PruneIndexTool.PruneChecker.html#isPrunable(org.apache.lucene.search.Query, org.apache.lucene.index.IndexReader, int)"><code>PruneIndexTool.PruneChecker.isPrunable(Query, IndexReader, int)</code></a>
 will be called in turn, for each matching document, and if it returns true this means that
 the document should be deleted. A logical AND is performed on the results returned
 by all checkers (which means that if one of them returns false, the document will
 not be deleted).</dd><dd><code>unlock</code> - if true, and if any of the input indexes is locked, forcibly
 unlock it. Use with care, only when you are sure that other processes don't
 modify the index at the same time.</dd><dd><code>dryrun</code> - if set to true, don't change the index, just show what would be done.
 If false, perform all actions, changing indexes as needed. Note: dryrun doesn't prevent
 PruneCheckers from performing changes or causing any other side-effects.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="run()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>run</h4>
<pre>public&nbsp;void&nbsp;run()</pre>
<div class="block">For each query, find all matching documents and delete them from all input
 indexes. Optionally, an additional check can be performed by using <a href="../../../../org/apache/nutch/tools/PruneIndexTool.PruneChecker.html" title="interface in org.apache.nutch.tools"><code>PruneIndexTool.PruneChecker</code></a>
 implementations.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code>run</code>&nbsp;in interface&nbsp;<code>java.lang.Runnable</code></dd>
</dl>
</li>
</ul>
<a name="main(java.lang.String[])">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>main</h4>
<pre>public static&nbsp;void&nbsp;main(java.lang.String[]&nbsp;args)
                 throws java.lang.Exception</pre>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
<a name="parseQueries(java.io.InputStream)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>parseQueries</h4>
<pre>public static&nbsp;org.apache.lucene.search.Query[]&nbsp;parseQueries(java.io.InputStream&nbsp;is)
                                                     throws java.lang.Exception</pre>
<div class="block">Read a list of Lucene queries from the stream (UTF-8 encoding is assumed).
 There should be a single Lucene query per line. Blank lines and comments
 starting with '#' are allowed.
 <p>NOTE: you may wish to use <a href="../../../../org/apache/nutch/searcher/Query.html#main(java.lang.String[])"><code>Query.main(String[])</code></a>
 method to translate queries from Nutch format to Lucene format.</p></div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>is</code> - InputStream to read from</dd>
<dt><span class="strong">Returns:</span></dt><dd>array of Lucene queries</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd></dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/PruneIndexTool.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../org/apache/nutch/tools/FreeGenerator.FG.html" title="class in org.apache.nutch.tools"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../org/apache/nutch/tools/PruneIndexTool.PrintFieldsChecker.html" title="class in org.apache.nutch.tools"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/apache/nutch/tools/PruneIndexTool.html" target="_top">Frames</a></li>
<li><a href="PruneIndexTool.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested_class_summary">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &copy; 2006 The Apache Software Foundation</small></p>
</body>
</html>
